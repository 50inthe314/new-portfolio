!function(t){"use strict";function a(t){if(-1==t.search("rgb"))return t;function a(t){return("0"+parseInt(t).toString(16)).slice(-2)}return"#"+a((t=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+a(t[2])+a(t[3])}wp.mce=wp.mce||{};var e={};e.button={content_id:"fasc-popup-edit-button",is_editing:!1,$node:{},init:function(t,a,e,i){this.$popup=a,this.$preview_area=a.find(".preview-button-area .centered-button"),this.is_editing=e,this.$node=jQuery(t),this.setupControls(a),this.setupIcons(t,a),this.setupTabs(a),this.is_editing?this.setSettingsFromNode(t,a,!0):this.initEmptyTemplate(t,a,i),this.updatePreview()},setupIcons:function(a,e){var i=this,c=(t(a),e.find('.fasc-ajax-content .fasc-tab-content[data-fasc-tab="2"]'));c.find("#fasc-popup-icon-type-select").change(function(a){t(this).val();c.find(".ico-grid .grid-container").removeClass("ico-screen-active").hide(),c.find("#"+t(this).val()).addClass("ico-screen-active").show()}),c.find(".ico-grid div").click(function(a){a.preventDefault();var e=c.find(".fasc-ico-position:checked").val();return c.find(".ico-grid div").removeClass("active"),t(this).addClass("active"),"none"!=e&&""!=e||(e="before"),c.find(".fasc-ico-position").removeAttr("checked"),c.find(".fasc-ico-position").prop("checked",!1),c.find('.fasc-ico-position[value="'+e+'"]').prop("checked",!0),i.updatePreview(),!1}),c.find(".fasc-ico-position").change(function(a){if(c.find(".fasc-ico-position").removeAttr("checked"),c.find(".fasc-ico-position").prop("checked",!1),t(this).prop("checked",!0),"none"==t(this).val())c.find(".ico-grid div div:not(.clear)").removeClass("active");else if(c.find(".ico-grid div.active").length<1){c.find(".ico-grid .grid-container.ico-screen-active").length>0?t(c.find(".ico-grid .grid-container.ico-screen-active div:not(.clear)").get(0)).addClass("active"):t(c.find(".ico-grid .grid-container:first-child div:not(.clear)").get(0)).addClass("active")}i.updatePreview()}),t('.fasc-ajax-content select, .fasc-ajax-content input[type="checkbox"]').change(function(){i.updatePreview()}),t('.fasc-ajax-content input[type="text"]').keyup(function(){i.updatePreview()}),t('.fasc-ajax-content input[type="text"]').keyup(function(){i.updatePreview()}),t.get(Fasc.ajax_url+"?action=fasc_buttons&load=get_buttons",function(t){i.parseTemplateButtons(t)},"json"),t(".fasc-save-btn").click(function(){var a={};return a.button=i.createButtonHtml({isSaving:!0}),t.post(Fasc.ajax_url+"?action=fasc_buttons&load=save_button",a,function(t){i.parseTemplateButtons(t)},"json"),i.$tabs.find("li").removeClass("active"),i.$tabs.find("li[data-fasc-tab='3']").addClass("active"),i.loadTab(3,e),!1}),i.updatePreview()},parseTemplateButtons:function(a){var e=this,i=t(".saved-buttons-tab .container-grid ul");i.empty();var c="",o=0;t.each(a,function(e){c="";var n=t(a[e].html),s=n.css("background-color"),r=n.css("color");c+="<li data-index='"+o+"'>",c+='<div class="wrap">',c+='<div class="full_button">'+a[e].html+"</div>",c+='<div class="name"><span>'+a[e].name+'</span> <a class="dashicons dashicons-edit fasc-button-edit"></a><a class="fa fa-check fasc-button-update" data-action="update"></a><a class="dashicons dashicons-no-alt fasc-button-update" data-action="remove"></a></div>',c+='<div class="col fasc-button-remove dashicons dashicons-no-alt"></div>',c+='<div class="col" style="background-color:'+s+';"></div>',c+='<div class="col" style="background-color:'+r+';"></div>',c+='<div class="clear"></div>',c+="</div>",c+="</li>",i.append(c),o++});var n=function(a){var e=a.text(),i=t("<input>",{val:e,type:"text",width:"170px","data-orig-text":e});a.replaceWith(i),i.select()},s=function(a){var e=t("<span>",{text:a.attr("data-orig-text")});a.replaceWith(e),e.on("click",n)},r=function(a){var e=t("<span>",{text:a.val()});a.replaceWith(e),e.on("click",n)};t(".fasc-button-edit").click(function(){return t(this).hide(),t(this).parent().find(".fasc-button-update").show().css("display","inline-block"),n(t(this).parent().find("span")),!1}),t(".fasc-button-remove").click(function(a){a.preventDefault();var i=t(this).closest("li").attr("data-index");return t.get(Fasc.ajax_url+"?action=fasc_buttons&load=remove_button&index="+i,function(t){e.parseTemplateButtons(t)},"json"),!1}),t(".fasc-button-update").click(function(){var a=t(this);if(t(this).parent().find(".fasc-button-update").hide(),t(this).parent().find(".fasc-button-edit").show(),"remove"==a.attr("data-action"))s(t(this).parent().find("input"));else{var i=t(this).closest("li").attr("data-index"),c=encodeURIComponent(t(this).parent().find("input").val());t.get(Fasc.ajax_url+"?action=fasc_buttons&load=update_button&index="+i+"&name="+c,function(t){e.parseTemplateButtons(t)},"json"),r(t(this).parent().find("input"))}return!1});var p=t(".saved-buttons-tab .container-grid li .wrap");p.on("click",function(){p.removeClass("active"),t(this).addClass("active");var a=t(this).find(".full_button a.fasc-button");e.loadButtonTemplate(a,!0),e.updatePreview()})},loadButtonTemplate:function(e,i){var c=this,o=e.attr("target");jQuery(".fasc-ajax-content input#fasc-popup-new-window").prop("checked",!1),void 0!==o&&"_blank"==o&&jQuery(".fasc-ajax-content input#fasc-popup-new-window").prop("checked",!0);var n=e.attr("rel");if(jQuery(".fasc-ajax-content input#fasc-popup-nofollow").prop("checked",!1),void 0!==n&&-1!==n.indexOf("nofollow")&&jQuery(".fasc-ajax-content input#fasc-popup-nofollow").prop("checked",!0),void 0===i){var s=e.text();jQuery(".fasc-ajax-content input#fasc-popup-button-text").val(s)}var r=a(e.css("color"));jQuery("#fasc-popup-text-color").val(r),c.refreshMiniColors(jQuery("#fasc-popup-text-color"),r,c.$popup);var p=a(e.css("background-color"));jQuery("#fasc-popup-button-color").val(p),c.refreshMiniColors(jQuery("#fasc-popup-button-color"),p,c.$popup);var f=c.$popup.find('.fasc-ajax-content .fasc-tab-content[data-fasc-tab="2"]');f.find(".ico-grid > div > div").removeClass("active");var d=e.attr("class").split(/\s+/);c.$popup.find(".fasc-mce-button[data-fasc-action='bold']").attr("data-fasc-button-active","0"),c.$popup.find(".fasc-mce-button[data-fasc-action='italic']").attr("data-fasc-button-active","0"),c.$popup.find(".fasc-mce-button[data-fasc-action='strikethrough']").attr("data-fasc-button-active","0");for(var u=0;u<d.length;u++)if("fasc-type"==d[u].substring(0,9)){var l=d[u];(e.hasClass("fasc-rounded-medium")||e.hasClass("rounded"))&&(l+=" fasc-rounded-medium"),jQuery("#fasc-popup-button-type option").prop("selected",!1),jQuery('#fasc-popup-button-type option[value="'+l+'"]').prop("selected",!0),t("#fasc-popup-button-type").val(l)}else if("fasc-style"==d[u].substring(0,10))"fasc-style-bold"==d[u]?c.$popup.find(".fasc-mce-button[data-fasc-action='bold']").attr("data-fasc-button-active","1"):"fasc-style-italic"==d[u]?c.$popup.find(".fasc-mce-button[data-fasc-action='italic']").attr("data-fasc-button-active","1"):"fasc-style-strikethrough"==d[u]&&c.$popup.find(".fasc-mce-button[data-fasc-action='strikethrough']").attr("data-fasc-button-active","1");else if("fasc-size"==d[u].substring(0,9)){var v=d[u];jQuery("#fasc-popup-button-size option").prop("selected",!1),jQuery('#fasc-popup-button-size option[value="'+v+'"]').prop("selected",!0),t("#button-size").val(v)}else if("dashicons"==d[u].substring(0,9)){f.find(".ico-grid .grid-container").removeClass("ico-screen-active"),f.find("#dashicons-grid").addClass("ico-screen-active"),c.$popup.find("#fasc-popup-icon-type-select").val("dashicons-grid"),c.$popup.find("#fasc-popup-icon-type-select").trigger("change");var h=d[u];c.$popup.find(".ico-grid ."+h).addClass("active")}else if("fa-"==d[u].substring(0,3)){f.find(".ico-grid .grid-container").removeClass("ico-screen-active");var b=f.find(".ico-grid").find("."+d[u]).parent().attr("id");f.find("#"+b).addClass("ico-screen-active"),c.$popup.find("#fasc-popup-icon-type-select").val(b),c.$popup.find("#fasc-popup-icon-type-select").trigger("change"),c.$popup.find(".ico-grid ."+d[u]).addClass("active")}e.hasClass("fasc-ico-before")||e.hasClass("fasc-ico-after")?e.hasClass("fasc-ico-before")?(f.find(".fasc-ico-position").prop("checked",!1),f.find('.fasc-ico-position[value="before"]').prop("checked",!0)):e.hasClass("fasc-ico-after")&&(f.find(".fasc-ico-position").prop("checked",!1),f.find('.fasc-ico-position[value="after"]').prop("checked",!0)):(f.find(".fasc-ico-position").prop("checked",!1),f.find('.fasc-ico-position[value="none"]').prop("checked",!0))},setupControls:function(a){var e=this;a.find('.fasc-ajax-content select, .fasc-ajax-content input[type="checkbox"]').change(function(){e.updatePreview()}),a.find('.fasc-ajax-content input[type="text"]').keyup(function(){e.updatePreview()}),a.find('.fasc-ajax-content input[type="text"]').keyup(function(){e.updatePreview()});var i=a.find("[data-fasc-action='popup-colorpicker']");i.click(function(e){var c=t(this),o=c.attr("data-fasc-button-active");i.attr("data-fasc-button-active","");var n=1-o;c.attr("data-fasc-button-active",n);var s=c.data("fasc-action-target"),r=a.find('[data-fasc-colorpicker-name="'+s+'"]'),p=a.find("[data-fasc-colorpicker-name]").not('[data-fasc-colorpicker-name="'+s+'"]'),f=c.position();p.stop(!0,!0).hide(),r.stop(!0,!0).fadeToggle(100),r.css("left",Math.round(f.left)+"px"),r.css("top",Math.round(f.top+c.parent().outerHeight())+"px")}),a.on("click",function(e){0==t(e.target).closest("[data-fasc-action='popup-colorpicker'], .fasc-popup-colorpicker-container").length&&(a.find("[data-fasc-colorpicker-name]").hide(),i.attr("data-fasc-button-active",""))}),a.find(".fasc-mce-button-toggle").on("click",function(){var a=t(this),i=1-a.attr("data-fasc-button-active");a.attr("data-fasc-button-active",i),e.updatePreview()}),e.updatePreview()},updatePreview:function(){this.$preview_area.html(this.createButtonHtml()),this.$preview_area.find(".fasc-button").off(),this.$preview_area.find(".fasc-button").click(function(t){t.preventDefault(),t.stopPropagation()})},createButtonHtml:function(a){var e={content:"",isSaving:!1,hasID:!1};t.extend(e,a);var i=jQuery(".fasc-ajax-content input#fasc-popup-button-url").val(),c=jQuery(".fasc-ajax-content input#fasc-popup-button-text").val(),o=jQuery(".fasc-ajax-content select#fasc-popup-button-size").val(),n=jQuery(".fasc-ajax-content input#fasc-popup-button-color").val(),s=jQuery(".fasc-ajax-content input#fasc-popup-text-color").val(),r=jQuery(".fasc-ajax-content select#fasc-popup-button-type").val(),p=(jQuery(".fasc-ajax-content select#fasc-popup-button-align").val(),jQuery(".fasc-ajax-content input#fasc-popup-new-window").prop("checked")),f=jQuery(".fasc-ajax-content input#fasc-popup-nofollow").prop("checked"),d="",u="",l="",v="";1==p&&(l=' target="_blank"'),1==f&&(v=' rel="nofollow"'),r&&""!=r&&(d=" "+r),o&&""!=o&&(u=" "+o);var h=t(t('.fasc-ajax-content .fasc-tab-content[data-fasc-tab="2"] .ico-grid div.active').get(0)),b=t('.fasc-ajax-content .fasc-tab-content[data-fasc-tab="2"] .fasc-ico-position:checked').val(),g="";if(1==h.length){var m=h.attr("class").split(" "),k=0,x="dashicons";for(k=0;k<m.length;k++)"active"!=m[k]&&"fa"!=m[k]&&"dashicons"!=m[k]&&(g+=" "+m[k]),"fa"==m[k]&&(x="fontawesome");k>0&&("before"!=b&&"after"!=b||(g="fontawesome"==x?" ico-fa fasc-ico-"+b+g:" fasc-ico-"+b+g))}var y="";1==this.$popup.find(".fasc-mce-button[data-fasc-action='bold']").attr("data-fasc-button-active")&&(y+=" fasc-style-bold"),1==this.$popup.find(".fasc-mce-button[data-fasc-action='italic']").attr("data-fasc-button-active")&&(y+=" fasc-style-italic");var j=this.$popup.find(".fasc-mce-button[data-fasc-action='strikethrough']").attr("data-fasc-button-active");1==j&&(y+=" fasc-style-strikethrough");this.$popup.find(".fasc-mce-button[data-fasc-action='strikethrough']").attr("data-fasc-button-active");1==j&&(y+=" fasc-style-strikethrough");var w="";e.hasID&&(w=' data-fasc-id="fasc-button-tid-'+(new Date).getTime()+'"');return e.isSaving?'<a class="fasc-button'+u+d+g+y+'"'+l+v+' style="background-color:'+n+";color:"+s+';" data-fasc-style="background-color:'+n+";color:"+s+';"'+w+"></a>":'<a data-fasc-href="'+i+'" class="fasc-button'+u+d+g+y+'"'+l+v+' style="background-color:'+n+";color:"+s+';" data-fasc-style="background-color:'+n+";color:"+s+';"'+w+">"+c+"</a>"},setupTabs:function(a){var e=this;this.$tabs=a.find(".tab-header");var i=this.$tabs.find("li");this.$tabs.find("li a");i.click(function(){var c=t(this),o=c.attr("data-fasc-tab");return i.removeClass("active"),c.addClass("active"),e.loadTab(o,a),!1})},loadTab:function(a,e){e.find(".fasc-ajax-content .fasc-tab-content").hide(),e.find(".fasc-ajax-content .fasc-tab-content[data-fasc-tab="+a+"]").show(),this.loadTabContent(a),t(".ico-grid .grid-container div.active").length>0&&t(".ico-grid").scrollTop(t(".ico-grid .grid-container div.active").position().top-5)},loadTabContent:function(t,a){},refreshMiniColors:function(a,e,i){var c=this;jQuery(".preview-button-area .centered-button");a.is_text_input=!1,a.minicolors({inline:!0,opacity:!1,showSpeed:0,hideSpeed:0,textfield:!0,change:function(e,o){var n=a.val(),s=a.parent().parent().find(".fasc-popup-color-input");1==a.is_text_input?a.is_text_input=!1:s.val(n),s.off("input"),s.on("input",function(){var e=t(this).val();a.is_text_input=!0,a.minicolors("value",e)});var r=t("#fasc-popup-button-color").val(),p=t("#fasc-popup-text-color").val();i.find(".fasc-ico-fg .fg-panel").css("background-color",p),i.find(".fasc-ico-bg .bg-panel").css("background-color",r),c.updatePreview()}}),void 0!==e&&a.minicolors("value",e)},initEmptyTemplate:function(t,e,i){jQuery("#fasc-popup-button-text").val(i);var c=e.find(".preview-button-area .centered-button .fasc-button");this.refreshMiniColors(e.find("#fasc-popup-text-color"),a(c.css("color")),e),this.refreshMiniColors(e.find("#fasc-popup-button-color"),a(c.css("background-color")),e)},setSettingsFromNode:function(e,i,c){var o=t(e),n=o.attr("data-fasc-href");i.find(".fasc-ajax-content input#fasc-popup-button-url").val(n);var s=o.attr("target");i.find(".fasc-ajax-content input#fasc-popup-new-window").prop("checked",!1),void 0!==s&&"_blank"==s&&i.find(".fasc-ajax-content input#fasc-popup-new-window").prop("checked",!0);var r=o.attr("rel");i.find(".fasc-ajax-content input#fasc-popup-nofollow").prop("checked",!1),void 0!==r&&-1!==r.indexOf("nofollow")&&i.find(".fasc-ajax-content input#fasc-popup-nofollow").prop("checked",!0);var p=o.text();i.find(".fasc-ajax-content input#fasc-popup-button-text").val(p);var f=a(o.css("color"));i.find("#fasc-popup-text-color").val(f),i.find(".fasc-ico-fg .fg-panel").css("background-color",f),this.refreshMiniColors(i.find("#fasc-popup-text-color"),f,i);var d=a(o.css("background-color"));i.find("#fasc-popup-button-color").val(d),i.find(".fasc-ico-bg .bg-panel").css("background-color",d),this.refreshMiniColors(i.find("#fasc-popup-button-color"),d,i);var u=i.find('.fasc-ajax-content .fasc-tab-content[data-fasc-tab="2"]'),l=o.attr("class").split(/\s+/);u.find(".ico-grid > div > div").removeClass("active");for(var v=0;v<l.length;v++)if("fasc-type"==l[v].substring(0,9)){var h=l[v];(o.hasClass("fasc-rounded-medium")||o.hasClass("rounded"))&&(h+=" fasc-rounded-medium"),i.find("#fasc-popup-button-type option").prop("selected",!1),i.find('#fasc-popup-button-type option[value="'+h+'"]').prop("selected",!0),i.find("#fasc-popup-button-type").val(h)}else if("fasc-style"==l[v].substring(0,10))"fasc-style-bold"==l[v]?i.find(".fasc-mce-button[data-fasc-action='bold']").attr("data-fasc-button-active","1"):"fasc-style-italic"==l[v]?i.find(".fasc-mce-button[data-fasc-action='italic']").attr("data-fasc-button-active","1"):"fasc-style-strikethrough"==l[v]&&i.find(".fasc-mce-button[data-fasc-action='strikethrough']").attr("data-fasc-button-active","1");else if("fasc-size"==l[v].substring(0,9)){var b=l[v];i.find("#fasc-popup-button-size option").prop("selected",!1),i.find('#fasc-popup-button-size option[value="'+b+'"]').prop("selected",!0),i.find("#fasc-popup-button-size").val(b)}else if("dashicons"==l[v].substring(0,9)){u.find(".ico-grid .grid-container").removeClass("ico-screen-active"),u.find("#dashicons-grid").addClass("ico-screen-active"),i.find("#fasc-popup-icon-type-select").val("dashicons-grid"),i.find("#fasc-popup-icon-type-select").trigger("change");var g=l[v];i.find(".ico-grid ."+g).addClass("active")}else if("fa-"==l[v].substring(0,3)){u.find(".ico-grid .grid-container").removeClass("ico-screen-active");var m=u.find(".ico-grid").find("."+l[v]).parent().attr("id");u.find("#"+m).addClass("ico-screen-active"),i.find("#fasc-popup-icon-type-select").val(m),i.find("#fasc-popup-icon-type-select").trigger("change"),i.find(".ico-grid ."+l[v]).addClass("active")}o.hasClass("fasc-ico-before")||o.hasClass("fasc-ico-after")?o.hasClass("fasc-ico-before")?(u.find(".fasc-ico-position").prop("checked",!1),u.find('.fasc-ico-position[value="before"]').prop("checked",!0)):o.hasClass("fasc-ico-after")&&(u.find(".fasc-ico-position").prop("checked",!1),u.find('.fasc-ico-position[value="after"]').prop("checked",!0)):(u.find(".fasc-ico-position").prop("checked",!1),u.find('.fasc-ico-position[value="none"]').prop("checked",!0))}},wp.mce.fascpopup={open:function(a,i,c,o,n){this.type=i,this.templateID=i,this.is_editing=o;var s=e[i].content_id,r=jQuery("<div/>",{class:"fasc-thickbox-overlay"}).appendTo("body"),p=t("#fasc-popup-template").clone();p.removeAttr("id"),p.addClass(s);var f=t("#"+s),d=f.clone();f.remove();var u=p.find(".fasc-thickbox-content"),l=p.find(".fasc-thickbox-title-inner"),v=p.find(".fasc-thickbox-action-right");this.initTemplate(p,d,u,l,v),p.insertAfter(r),e[i].init(a,p,this.is_editing,n),p.show(),this.initEvents(a,p,v,u,d,c)},initTemplate:function(t,a,e,i,c){e.html(a.html());var o=a.attr("data-fasc-title"),n=a.attr("data-fasc-submit-label"),s=a.attr("data-fasc-width"),r=a.attr("data-fasc-height");i.text(o),c.text(n),t.css("max-width",s),t.css("max-height",r)},initEvents:function(a,i,c,o,n,s){var r=this;i.find("label").click(function(){}),i.find(".fasc-close-ajax-window").click(function(){r.removePopup(i,n)}),t(".fasc-thickbox-overlay").on("click",function(t){r.removePopup(i,n)}),c.click(function(t){t.preventDefault(),t.stopImmediatePropagation();var a=e[r.type].createButtonHtml({isSaving:!1,hasID:!0}),c=jQuery(a).attr("data-fasc-id");return s(a,c),r.removePopup(i,n),!1});var p=n.attr("data-fasc-width"),f=n.attr("data-fasc-height");t(window).resize(_.debounce(function(){r.centerPopup(i)},100)),r.centerPopup(i,p,f)},removePopup:function(a,i){var c=this;t(".fasc-thickbox-overlay").remove(),a.remove(),t("body").append(i),i.attr("id",e[c.type].content_id)},centerPopup:function(a,e,i){var c=a.find(".fasc-thickbox-header"),o=a.find(".fasc-thickbox-footer"),n=a.find(".fasc-thickbox-content"),s=(t(window),-a.height()/2),r=-a.width()/2;a.css("position","fixed").css({"margin-left":r+"px","margin-top":s+"px",left:"50%",top:"50%"}),n.hide();var p=a.outerHeight();p-=c.outerHeight(),p-=o.outerHeight(),n.height(p),n.show()}}}(jQuery);